<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Panel Karaoke BÃºzios â€” Fiesta ðŸŒ´ðŸŽ¤</title>
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0;
      background: linear-gradient(-45deg, #00c3ff, #ffff66, #ff99cc, #66ff99);
      background-size: 400% 400%;
      animation: gradient 12s ease infinite;
      color: #333;
      padding: 20px;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 {text-align:center; font-size:2.2em; margin-bottom:10px; color:#fff; text-shadow:1px 1px 5px #000;}
    h2 {margin-top:30px; color:#fff; text-shadow:1px 1px 3px #000;}
    table {width:100%; border-collapse: collapse; margin-top:10px; background: rgba(255,255,255,0.9); border-radius:8px; overflow:hidden;}
    th,td {padding:10px; text-align:left; border-bottom:1px solid #eee;}
    tr.new {animation:fadein 0.7s;}
    tr.pending{background:#d4f7dc;}
    tr.done{background:#f7f0d4;}
    .lang-es{color:#ff9900; font-weight:bold;}
    .lang-pt{color:#33cc33; font-weight:bold;}
    .lang-en{color:#0099ff; font-weight:bold;}
    button {padding:6px 12px; border:none; border-radius:6px; cursor:pointer; transition:0.3s; font-weight:bold;}
    button.doneBtn {background:#00ccff; color:white;}
    button.deleteBtn {background:#ff4d4d; color:white;}
    button:hover {opacity:0.8;}
    .section {margin-bottom:40px;}
    @keyframes fadein {from{opacity:0} to{opacity:1}}

    /* BotÃ³n del chat */
    #chatToggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(45deg,#ffcc00,#00cc33);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.8em;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      cursor: pointer;
      transition: 0.3s;
    }
    #chatToggle:hover { transform: scale(1.1); }

    /* Ventana de chat */
    #chatWindow {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 320px;
      height: 400px;
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
      display: none;
      flex-direction: column;
      overflow: hidden;
      animation: fadein 0.5s ease;
    }
    #chatHeader {
      background: linear-gradient(45deg,#00c3ff,#00cc33);
      color: #fff;
      text-align: center;
      padding: 10px;
      font-weight: bold;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      font-size: 0.9em;
      background: rgba(255,255,255,0.7);
    }
    .msg {margin-bottom: 5px;}
    #chatInput {
      border: none;
      padding: 8px;
      width: 90%;
      margin: 5px auto;
      border-radius: 6px;
      display: block;
    }
    #sendBtn {
      background: #00c3ff;
      color: #fff;
      border: none;
      width: 90%;
      margin: 5px auto 10px;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¤ Karaoke BÃºzios â€” Fiesta en la Playa ðŸŒ´ðŸŽ¶<br>Show / Festa / Party</h1>

  <div class="section">
    <h2>Pendientes / Ainda nÃ£o cantaram / Pending ðŸŽµ</h2>
    <table>
      <thead>
        <tr><th>#</th><th>Hora / Time</th><th>Idioma / Language</th><th>Nombre / Name</th><th>CanciÃ³n / Song</th><th>Artista / Artist</th><th>Acciones / Actions</th></tr>
      </thead>
      <tbody id="pendingBody"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Ya cantaron / JÃ¡ cantaram / Already sang ðŸŽ¤</h2>
    <table>
      <thead>
        <tr><th>#</th><th>Hora / Time</th><th>Idioma / Language</th><th>Nombre / Name</th><th>CanciÃ³n / Song</th><th>Artista / Artist</th><th>Acciones / Actions</th></tr>
      </thead>
      <tbody id="doneBody"></tbody>
    </table>
  </div>

  <button id="chatToggle">ðŸ’¬</button>

  <div id="chatWindow">
    <div id="chatHeader">ðŸ’¬ Chat en vivo / Chat ao vivo / Live chat</div>
    <div id="messages"></div>
    <input type="text" id="chatInput" placeholder="Escribe aquÃ­ / Digite aqui / Type here...">
    <button id="sendBtn">Enviar / Enviar / Send</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDM0CAPFLXh_bVDCh43rJs_XCfcvATtnjg",
      authDomain: "buzios-karaoke-fb.firebaseapp.com",
      databaseURL: "https://buzios-karaoke-fb-default-rtdb.firebaseio.com",
      projectId: "buzios-karaoke-fb",
      storageBucket: "buzios-karaoke-fb.firebasestorage.app",
      messagingSenderId: "420981577649",
      appId: "1:420981577649:web:c5b5c3baa23cfd480d4f90"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const pendingBody = document.getElementById('pendingBody');
    const doneBody = document.getElementById('doneBody');
    let counter = 0;

    function escapeHtml(s){ return s ? s.replace(/[&<>"]|'/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m])) : ''; }

    db.ref('karaoke/entries').limitToLast(200).on('child_added', snap=>{
      const data = snap.val();
      const key = snap.key;
      addRow(data, key, pendingBody, 'pending');
    });

    db.ref('karaoke/entries').on('child_removed', snap=>{
      const key = snap.key;
      let row = document.querySelector(`tr[data-key="${key}"]`);
      if(row) row.remove();
    });

    function addRow(data, key, tableBody, status){
      counter++;
      const tr = document.createElement('tr');
      tr.className = status;
      tr.setAttribute('data-key', key);
      const date = new Date(data.timestamp);
      tr.innerHTML = `
        <td>${counter}</td>
        <td>${date.toLocaleTimeString()}</td>
        <td class="lang-${data.language}">${data.language}</td>
        <td>${escapeHtml(data.name)}</td>
        <td>${escapeHtml(data.song)}</td>
        <td>${escapeHtml(data.artist)}</td>
        <td>
          ${status==='pending'?`<button class="doneBtn" onclick="markDone('${key}', this)">Ya cantÃ³ / JÃ¡ cantou / Done</button>`:''}
          <button class="deleteBtn" onclick="deleteEntry('${key}', this)">Eliminar / Remover / Delete</button>
        </td>
      `;
      tableBody.prepend(tr);
    }

    function markDone(key, btn){
      db.ref('karaoke/entries/' + key).once('value').then(snap=>{
        const data = snap.val();
        if(!data) return;
        const row = btn.closest('tr');
        row.remove();
        addRow(data, key, doneBody, 'done');
      });
    }

    function deleteEntry(key){
      if(confirm("Â¿Eliminar esta entrada? / Deseja remover esta inscriÃ§Ã£o? / Delete this entry?")){
        db.ref('karaoke/entries/' + key).remove()
          .catch(err=>alert("Error: " + err));
      }
    }

    // --- CHAT EN VIVO ---
    const chatToggle = document.getElementById('chatToggle');
    const chatWindow = document.getElementById('chatWindow');
    const messagesDiv = document.getElementById('messages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');

    chatToggle.addEventListener('click', ()=>{
      chatWindow.style.display = chatWindow.style.display==='flex' ? 'none' : 'flex';
    });

    db.ref('karaoke/chat').limitToLast(50).on('child_added', snap=>{
      const msg = snap.val();
      const div = document.createElement('div');
      div.className = 'msg';
      div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    sendBtn.addEventListener('click', ()=>{
      const text = chatInput.value.trim();
      if(!text) return;
      db.ref('karaoke/chat').push({ user: 'ADMIN', text, time: Date.now() });
      chatInput.value = '';
    });
  </script>
</body>
</html>
